<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Bot Tradingowy – Panel</title>
    <style>
        body { font-family: Arial; margin: 40px; background: #f9f9f9; }
        h1, h2 { margin-top: 0; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
        th, td { padding: 8px 12px; border: 1px solid #ccc; text-align: center; }
        th { background-color: #eee; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin-bottom: 40px; background: #fff; padding: 20px; border-radius: 6px; box-shadow: 0 0 5px #ddd; }
        .green { color: green; }
        .red { color: red; }
    </style>
</head>
<body>
<div class="container">
    <h1>📈 Bot Tradingowy – Panel Podglądu</h1>

    <div class="section" id="live-section">
        <h2>📡 Handel na żywo</h2>
        <div id="live-content"><p>Ładowanie danych...</p></div>
    </div>

    <div class="section">
        <h2>🔍 Statystyki ogólne</h2>
        <p><strong>Łączna liczba transakcji:</strong> {{ stats.total }}</p>
        <p><strong>Średni zysk/strata (PnL):</strong> {{ '%.2f' | format(stats.mean_pnl) }}</p>
        <p><strong>Zamknięcia pozycji BUY/SELL:</strong> {{ stats.buy }}</p>
        <p><strong>Stop Loss:</strong> {{ stats.sl }} | <strong>Take Profit:</strong> {{ stats.tp }}</p>
    </div>

    {% if equity_plot %}
    <div class="section">
        <h2>📊 Krzywa kapitału</h2>
        <img src="data:image/png;base64,{{ equity_plot }}" alt="Equity Plot" style="width: 100%; max-height: 400px;">
    </div>
    {% endif %}

    <div class="section">
        <h2>📄 Ostatnie transakcje</h2>
        <table>
            <tr>
                <th>Czas</th>
                <th>Akcja</th>
                <th>Cena wejścia</th>
                <th>Cena wyjścia</th>
                <th>Zysk/Strata</th>
            </tr>
            {% for trade in trades %}
            <tr>
                <td>{{ trade['time'] }}</td>
                <td>{{ trade['action'] }}</td>
                <td>{{ '%.5f'|format(trade['entry']) }}</td>
                <td>{{ '%.5f'|format(trade['exit']) }}</td>
                <td class="{{ 'green' if trade['pnl'] >= 0 else 'red' }}">{{ '%.2f'|format(trade['pnl']) }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

<script>
function updateLive() {
    fetch("/live")
    .then(response => response.json())
    .then(data => {
        const liveDiv = document.getElementById("live-content");
        if (data.timestamp) {
            liveDiv.innerHTML = `
                <p><strong>Czas:</strong> ${data.timestamp}</p>
                <p><strong>Cena:</strong> ${parseFloat(data.price).toFixed(5)}</p>
                <p><strong>Akcja bota:</strong> ${data.action}</p>
                <p><strong>Pozycja:</strong> ${data.position || 'Brak'}</p>
                <p><strong>Saldo:</strong> ${parseFloat(data.balance).toFixed(2)} |
                   <strong>Equity:</strong> ${parseFloat(data.equity).toFixed(2)}</p>
            `;
        } else {
            liveDiv.innerHTML = "<p>Brak aktualnych danych</p>";
        }
    });
}
setInterval(updateLive, 30000);
window.onload = updateLive;
</script>

</body>
</html>
